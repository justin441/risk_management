{% extends 'risk_register/base.html' %}
{% load i18n humanize %}
{% block title %}
  {% blocktrans with bu=bu.denomination %}
    Registre des risques de {{ bu }}
  {% endblocktrans %}
{% endblock %}
{% block header %}
  {% include 'risk_register/bu_card.html' %}
{% endblock %}
{% block content %}
{#  onglets#}
  <ul class="nav nav-tabs nav-justified">
    <li class="nav-item">
      <a href="#processus" class="nav-link active" role="tab" data-toggle="tab"></a>
    </li>
    <li class="nav-item">
      <a href="#risquesprocessus" class="nav-link" role="tab" data-toggle="tab"></a>
    </li>
    <li class="nav-item">
      <a href="#risquesactivites" class="nav-link" role="tab" data-toggle="tab"></a>
    </li>
  </ul>

{# contenu #}
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active mt-3" id="processus">
      {% if bu.processus_set.all %}
        {% for processus in bu.processus_set.all %}
          <div class="card">
            <div class="card-header">
              <a href="#" class="card-link h4">{{ processus.nom }}</a> {# TODO: ajouter l'url#}
              <a class="card-link pull-right" data-toggle="collapse" href="#{{ processus.nom }}-activities">
                <span data-feather="more-horizontal" class="text-info"></span>
              </a>
            </div>
            <div id="{{ processus.nom }}-activities" class="collapse">
              {% if processus.activites.all %}
                {% for activite in processus.activites.all %}
                  <div class=" card card-body">
                    <a href="#" class="h5 card-link">{{ activite.nom }}</a></li>{# TODO: ajouter l'url#}
                  </div>
                {% endfor %}
              {% else %}
                <h5>{% trans Ce processus ne comporte aucune activité %}</h5>
              {% endif %}
              <a href="#" class="text-info h5 card-link">
                <span data-feather="plus"></span> {% trans Nouvelle activité %}
              </a>{# TODO: ajouter l'url de création d'activité#}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <h5>{% trans Ce Business unite ne comporte aucun processus pour le moment %}</h5>
      {% endif %}
      <a href="#" class="text-info h4 card-link">
        <span data-feather="plus"></span> {% trans Nouveau processus %}
      </a>{# TODO: ajouter l'url de création de processus#}
    </div>
    <div role="tabpanel" class="tab-pane mt-3" id="risquesprocessus">

        <div class="table-responsive">
          <table class="table table-striped table-sm" id="processusRisqueTable">
          <thead>
          <tr>
            <th>{% trans Ajouté %}</th>
            <th>{% trans processus %}</th>
            <th>{% trans Risque %}</th>
            <th>{% trans Ajouté par %}</th>
            <th>{% trans Vérification %}</th>
            <th>{% trans Seuil de risque %}</th>
            <th>{% trans Facteur risque %}</th>
            <th>{% trans Statut du risque %}</th>
            <th>{% trans Propriétaire %}</th>
            <th>{% trans Date de revue %}</th>
          </tr>
          </thead>
          <tbody>
          {% if processusrisques %}
             {% for processusrisque in processusrisques %}
              <tr>
                <td>{{ processusrisque.created|naturaltime }}</td>
                <td>{{ processusrisque.processus }}</td>
                <td>{{ processusrisque.risque.nom }}</td>
                <td>{{ processusrisque.soumis_par }}</td>
                <td>
                  {% if processusrisque.verifie == 'verified' %}
                    <span data-feather="check" class="text-success"></span>
                    {% else %}
                    <span class="text-danger">{{ processusrisque.verifie }}</span>
                  {% endif %}
                </td>
                <td>{{ processusrisque.seuil_diplay|safe|default_if_none:_('Non defini') }}</td>
                <td>{{ processusrisque.facteur_risque_display|safe }}</td>
                <td>{{ processusrisque.status }}</td>
                <td><a href="#">{{ processusrisque.get_proprietaire|default_if_none:_('Non assigné') }}</a></td> {# TODO: ajouter l'url#}
                <td>
                  {% if processusrisque.est_obsolete %}
                    <span class="text-danger">{% trans passée %} {{ processusrisque.date_revue|naturaltime }}</span>
                  {% else %}
                    <span class="text-success">{{ processusrisque.date_revue|naturaltime }}</span>
                  {% endif %}
                </td>
              </tr>
             {% endfor %}

            {% endif %}
          </tbody>

          </table>
        </div>
    </div>
    <div role="tabpanel" class="tab-pane" id="risquesactivites">
      <div class="table-responsive">
          <table class="table table-striped table-sm" id="activiteRisqueTable">
          <thead>
          <tr>
            <th>{% trans Ajouté %}</th>
            <th>{% trans Activités %}</th>
            <th>{% trans Risque %}</th>
            <th>{% trans Ajouté par %}</th>
            <th>{% trans Vérification %}</th>
            <th>{% trans Seuil de risque %}</th>
            <th>{% trans Facteur risque %}</th>
            <th>{% trans Statut du risque %}</th>
            <th>{% trans Propriétaire %}</th>
            <th>{% trans Date de revue %}</th>
          </tr>
          </thead>
          <tbody>
          {% if activiterisques %}
             {% for activiterisque in activiterisques %}
              <tr>
                <td>{{ activiterisque.created|naturaltime }}</td>
                <td>{{ activiterisque.activite }}</td>
                <td>{{ activiterisque.risque.nom }}</td>
                <td>{{ activiterisque.soumis_par }}</td>
                <td>
                  {% if activiterisque.verifie == 'verified' %}
                    <span data-feather="check" class="text-success"></span>
                    {% else %}
                    <span class="text-danger">{{ activiterisque.verifie }}</span>
                  {% endif %}
                </td>
                <td>{{ activiterisque.seuil_diplay|safe|default_if_none:_('Non defini') }}</td>
                <td>{{ activiterisque.facteur_risque_display|safe }}</td>
                <td>{{ activiterisque.status }}</td>
                <td><a href="#">{{ activiterisque.get_proprietaire|default_if_none:_('Non assigné') }}</a></td> {# TODO: ajouter l'url#}
                <td>
                  {% if activiterisque.est_obsolete %}
                    <span class="text-danger">{% trans passée %} {{ activiterisque.date_revue|naturaltime }}</span>
                  {% else %}
                    <span class="text-success">{{ activiterisque.date_revue|naturaltime }}</span>
                  {% endif %}
                </td>
              </tr>
             {% endfor %}

            {% endif %}
          </tbody>

          </table>
        </div>
    </div>
  </div>
{% endblock %}

