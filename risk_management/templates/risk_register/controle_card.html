{% load i18n humanize %}
<div class="card m-4 mt-2 border-0">
  <div class="card-header">
    <a href="{% url 'risk_register:effacer_controle' controle=controle.pk %}" class="fm-delete"
       data-fm-callback="reload"
       data-fm-head="{% trans 'Supprimer un contrôle' %}">
      <span data-feather="x" class="float-right text-danger ml-3"></span>
    </a>
    <a class="card-link float-right text-info" data-toggle="collapse" href="#controle-{{ controle.pk }}">
      {% trans 'Détails' %} <span data-feather="more-horizontal"></span>
    </a>
    <a href="{% url 'risk_register:modifier_controle' controle=controle.pk %}"
       class="fm-update card-title h5"
       data-fm-callback="reload"
       data-fm-head="{% trans 'Modifier un contrôle' %}">
      {{ controle.nom }}
    </a>
    <strong class="ml-2 nowrap">{% trans 'Cible' %}: <span
      class="text-capitalize text-primary">{{ controle.get_critere_cible_display }}</span></strong>
    <div style="font-size: 90%">
      <span
        class="text-muted">{% trans 'Ajouté' %} {{ controle.created | naturaltime }} {% trans 'par' %} {{ controle.cree_par }}</span><br>
      {% if controle.modifie_par %}
        <span
          class="text-muted">{% trans 'Modifié' %} {{ controle.modified | naturaltime }} {% trans 'par' %} {{ controle.modifie_par }}</span>
        <br>
      {% endif %}
    </div>

  </div>
  <div id="controle-{{ controle.pk }}" class="collapse">
  <div class="card-body">

    <p class="text-justify">{{ controle.description | default_if_none:'' | truncatewords:25 }}</p>

    <div class="row">
      <div class="col-md-3">
        <h6 class="mb-0">{% trans 'Debut' %}:</h6>
        <span class="text-muted">{{ controle.start | naturalday }}</span>
      </div>
      <div class="col-md-3">
        <h6 class="mb-0">{% trans 'Fin' %}:</h6>
        <span class="{{ controle.status_display }}">{{ controle.end | naturalday }}</span>
      </div>
      {% if controle.est_approuve %}
        <div class="col-md-3">
          <h6 class="mb-0">{% trans 'Statut' %}:</h6>
          <span class="{{ controle.status_display }} controle-status"
                id="status-{{ controle.pk }}"
                data-check-url="{% url 'risk_register:ajax-status-controle' pk=controle.pk %}"
                data-change-url="{% url 'risk_register:ajax-changer-statut-controle' pk=controle.pk %}">
          {% csrf_token %}
        </span>
        </div>
      {% endif %}
      {% if controle.assigne_a %}
        <div class="col-md-3">
          <h6 class="mb-0">{% trans 'Propriétaire' %}</h6>
          <h6 class="text-muted">{{ controle.assigne_a }}</h6>
        </div>
      {% endif %}
    </div>
    <a href="" class="float-right text-info" id="controle-menu-{{ controle.pk }}" data-toggle="dropdown"
       aria-haspopup="true" aria-expanded="false" style="text-decoration: none;">
      <span data-feather="more-horizontal"></span>
    </a>
    <div class="dropdown-menu" aria-labelledby="controle-menu-{{ controle.pk }}">
      <a href="{% url 'risk_register:modifier_controle' controle=controle.pk %}"
         class="dropdown-item fm-update"
         data-fm-callback="reload"
         data-fm-head="{% trans 'Modifier un contrôle' %}">
        {% trans 'Modifier' %}
      </a>
      <a href="{% url 'risk_register:assigner_controle' controle=controle.pk %}"
         class="dropdown-item fm-update"
         data-fm-callback="reload"
         data-fm-head="{% trans 'Assigner un contrôle' %}">
        {% trans 'Assigner' %}
      </a>
      <a href="" class="dropdown-item approve" id="approve-link-{{ controle.pk }}"
         data-check-url="{% url 'risk_register:ajax-get-controle-approuve' pk=controle.pk %}"
         data-change-url="{% url 'risk_register:ajax-approuver-controle' pk=controle.pk %}" data-toggle="tooltip"
         data-placement="bottom">
        {% csrf_token %}
        {% trans 'Approuvé' %}
      </a>
      {% if controle.status == 'completed' %}
        <a href="" class="dropdown-item validate" id="validate-link-{{ controle.pk }}"
           data-check-url="{% url 'risk_register:ajax-get-controle-valide' pk=controle.pk %}"
           data-change-url="{% url 'risk_register:ajax-validate-controle' pk=controle.pk %}" style="display: none">
          {% csrf_token %}
          {% trans 'Validé' %}
        </a>
      {% endif %}
    </div>
  </div>
  </div>
</div>
